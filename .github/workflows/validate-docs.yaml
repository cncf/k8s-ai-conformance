name: Validate Documentation

on:
  pull_request:
    paths:
      - 'docs/AIConformance-*.yaml'
      - 'docs/AIConformance-*.md'
      - 'scripts/yaml-to-markdown.go'
  push:
    branches:
      - main
    paths:
      - 'docs/AIConformance-*.yaml'
      - 'scripts/yaml-to-markdown.go'
  workflow_dispatch:

jobs:
  validate-markdown:
    name: Validate Markdown is in sync with YAML
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.23'

      - name: Install dependencies
        run: go mod download

      - name: Regenerate Markdown files
        run: go run scripts/yaml-to-markdown.go

      - name: Check for differences
        run: |
          if git diff --quiet docs/*.md; then
            echo "✅ Markdown files are up to date"
          else
            echo "❌ Markdown files are out of sync with YAML templates"
            echo ""
            echo "The following files have differences:"
            git diff --name-only docs/*.md
            echo ""
            echo "Diff:"
            git diff docs/*.md
            echo ""
            echo "Please regenerate the Markdown files by running:"
            echo "  go run scripts/yaml-to-markdown.go"
            echo ""
            echo "Then commit the updated Markdown files."
            exit 1
          fi

      - name: Check for untracked Markdown files
        run: |
          untracked=$(git ls-files --others --exclude-standard docs/*.md 2>/dev/null || true)
          if [ -n "$untracked" ]; then
            echo "❌ New Markdown files were generated but not committed:"
            echo "$untracked"
            echo ""
            echo "Please commit these files."
            exit 1
          fi
